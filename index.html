<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a1a;
            --muted: #a0a0a0;
            --line: #f0f0f0;
            --accent: #000000;
            --error: #e53e3e;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* Fixed Date Input Alignment - Strict Left */
        input[type="date"] {
            appearance: none;
            -webkit-appearance: none;
            min-height: 2.5rem;
            display: block;
            text-align: left;
            padding-left: 0;
            cursor: text;
            width: 100%;
        }

        /* Forces the date display values to the left */
        input[type="date"]::-webkit-datetime-edit {
            display: inline-flex;
            text-align: left;
            padding: 0;
            margin: 0;
            justify-content: flex-start;
        }

        /* Specific alignment for the fields inside the date input */
        input[type="date"]::-webkit-datetime-edit-fields-wrapper {
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: flex-start;
        }

        input[type="date"]::-webkit-calendar-picker-indicator { 
            opacity: 0.3; 
            cursor: pointer; 
            filter: grayscale(1);
            margin-left: auto; /* Pushes the icon to the right, keeping text left */
        }

        /* Custom Placeholder for Date */
        input[type="date"]::before {
            content: attr(data-placeholder);
            color: var(--muted);
            position: absolute;
            left: 0;
            pointer-events: none;
        }
        
        input[type="date"]:focus::before,
        input[type="date"]:valid::before {
            display: none;
        }

        .modal { display: none; background: rgba(255, 255, 255, 0.98); }
        .modal.active { display: flex; }

        .menu-dropdown { 
            display: none; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            border: 1px solid var(--line); 
            background: white;
            min-width: 100px;
        }
        .menu-dropdown.active { display: block; }

        .advanced-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .advanced-content.open { max-height: 200px; }

        .expandable { cursor: pointer; transition: color 0.2s; }
        .expandable:hover { color: var(--accent); }
        
        .collapsed-text { 
            display: -webkit-box; 
            -webkit-line-clamp: 1; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
            text-overflow: ellipsis;
            word-break: break-word;
        }

        .timeline-track { position: relative; padding-left: 2rem; }
        .timeline-track::before {
            content: '';
            position: absolute;
            left: 0.25rem;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--line);
        }
        .timeline-day { position: relative; padding-bottom: 2rem; }
        .timeline-dot {
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 9px;
            height: 9px;
            background: var(--bg);
            border: 1px solid var(--line);
            border-radius: 50%;
            transform: translateX(1px);
            z-index: 10;
        }
        .timeline-dot.has-event { background: var(--accent); border-color: var(--accent); }
        .timeline-dot.is-today { border-color: var(--accent); border-width: 2px; }

        .roadmap-event {
            background: #fafafa;
            border-left: 2px solid var(--line);
            padding: 0.5rem 0.75rem;
            margin-top: 0.5rem;
            border-radius: 0 4px 4px 0;
            width: 100%;
            box-sizing: border-box;
        }

        #validation-msg {
            height: 14px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        #validation-msg.visible { opacity: 1; }
    </style>
</head>
<body class="p-8 md:p-24 max-w-xl mx-auto" onclick="closeAllMenus()">

    <header class="flex justify-between items-baseline mb-20">
        <div>
            <h1 id="date-display" class="text-sm font-medium tracking-tight uppercase"></h1>
        </div>
        <button onclick="openAddModal()" class="text-[11px] uppercase tracking-widest text-muted hover:text-black transition-colors font-medium">
            + Add
        </button>
    </header>

    <main class="space-y-24">
        <section>
            <h2 class="text-[10px] uppercase tracking-[0.2em] text-muted mb-8 font-bold">Upcoming</h2>
            <div id="planner-content" class="space-y-12"></div>
        </section>

        <section>
            <h2 class="text-[10px] uppercase tracking-[0.2em] text-muted mb-8 font-bold">Roadmap</h2>
            <div id="visual-timeline" class="timeline-track"></div>
        </section>
    </main>

    <!-- Modal -->
    <div id="modal" class="modal fixed inset-0 z-50 flex-col items-center justify-center p-6" onclick="toggleModal(false)">
        <div class="w-full max-w-xs space-y-4" onclick="event.stopPropagation()">
            <h2 id="modal-title" class="text-[10px] uppercase tracking-[0.2em] text-muted font-bold">New Event</h2>
            
            <div class="space-y-6">
                <div>
                    <input type="text" id="event-title" placeholder="Event name" class="w-full text-xl outline-none bg-transparent border-b border-line pb-2 focus:border-black transition-colors">
                </div>
                <div class="relative">
                    <input type="date" id="event-date" data-placeholder="DD/MM/YY" required class="w-full text-xl outline-none bg-transparent border-b border-line pb-2 focus:border-black transition-colors">
                </div>
                
                <div class="pt-0">
                    <button onclick="toggleAdvanced()" class="text-[10px] uppercase tracking-widest text-muted flex items-center gap-1 hover:text-black">
                        Advanced <span id="advanced-arrow">↓</span>
                    </button>
                    <div id="advanced-section" class="advanced-content mt-4">
                        <textarea id="event-desc" placeholder="Add a description..." rows="3" class="w-full text-sm outline-none bg-transparent border border-line p-3 rounded-lg focus:border-black transition-colors resize-none"></textarea>
                    </div>
                </div>
            </div>

            <div id="validation-msg" class="text-[10px] text-red-500 font-medium uppercase tracking-wider">Please fill in both name and date.</div>

            <div class="flex gap-4 pt-2">
                <button onclick="saveEvent()" class="text-xs font-medium underline underline-offset-4">Save</button>
                <button onclick="toggleModal(false)" class="text-xs text-muted hover:text-black">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let events = JSON.parse(localStorage.getItem('ultra-minimal-planner')) || [];
        let editingId = null;

        function toggleModal(show) {
            document.getElementById('modal').classList.toggle('active', show);
            document.getElementById('validation-msg').classList.remove('visible');
            if (!show) {
                document.getElementById('advanced-section').classList.remove('open');
                document.getElementById('advanced-arrow').innerText = '↓';
            }
        }

        function toggleAdvanced() {
            const section = document.getElementById('advanced-section');
            const arrow = document.getElementById('advanced-arrow');
            section.classList.toggle('open');
            arrow.innerText = section.classList.contains('open') ? '↑' : '↓';
        }

        function openAddModal() {
            editingId = null;
            document.getElementById('modal-title').innerText = "New Event";
            document.getElementById('event-title').value = '';
            document.getElementById('event-date').value = '';
            document.getElementById('event-desc').value = '';
            toggleModal(true);
            setTimeout(() => document.getElementById('event-title').focus(), 50);
        }

        function openEditModal(id) {
            const event = events.find(e => e.id === id);
            if (!event) return;
            editingId = id;
            document.getElementById('modal-title').innerText = "Edit Event";
            document.getElementById('event-title').value = event.title;
            document.getElementById('event-date').value = event.date;
            document.getElementById('event-desc').value = event.description || '';
            if (event.description) {
                document.getElementById('advanced-section').classList.add('open');
                document.getElementById('advanced-arrow').innerText = '↑';
            }
            toggleModal(true);
        }

        function saveEvent() {
            const title = document.getElementById('event-title').value.trim();
            const date = document.getElementById('event-date').value;
            const description = document.getElementById('event-desc').value;
            const validation = document.getElementById('validation-msg');

            if (!title || !date) {
                validation.classList.add('visible');
                return;
            }
            
            validation.classList.remove('visible');

            if (editingId) {
                const index = events.findIndex(e => e.id === editingId);
                events[index] = { ...events[index], title, date, description };
            } else {
                events.push({ id: Date.now(), title, date, description });
            }
            saveAndRender();
            toggleModal(false);
        }

        function deleteEvent(id) {
            events = events.filter(e => e.id !== id);
            saveAndRender();
        }

        function toggleExpand(id, type) {
            const el = document.getElementById(`${type}-${id}`);
            if (el) el.classList.toggle('collapsed-text');
        }

        function saveAndRender() {
            localStorage.setItem('ultra-minimal-planner', JSON.stringify(events));
            render();
        }

        function toggleMenu(e, id) {
            e.stopPropagation();
            closeAllMenus();
            const menu = document.getElementById(`menu-${id}`);
            if (menu) menu.classList.toggle('active');
        }

        function closeAllMenus() {
            document.querySelectorAll('.menu-dropdown').forEach(m => m.classList.remove('active'));
        }

        function getLocalDateString(date) {
            const offset = date.getTimezoneOffset();
            const adjustedDate = new Date(date.getTime() - (offset * 60 * 1000));
            return adjustedDate.toISOString().split('T')[0];
        }

        function render() {
            const now = new Date();
            now.setHours(0,0,0,0);
            document.getElementById('date-display').innerText = now.toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });

            const container = document.getElementById('planner-content');
            const timelineContainer = document.getElementById('visual-timeline');
            const sorted = [...events].sort((a, b) => a.date.localeCompare(b.date));

            if (sorted.length === 0) {
                container.innerHTML = `<p class="text-sm text-muted italic">Nothing scheduled.</p>`;
                timelineContainer.innerHTML = `<p class="text-sm text-muted italic">No timeline available.</p>`;
            } else {
                container.innerHTML = sorted.map(e => {
                    const eventDate = new Date(e.date + 'T00:00:00');
                    const diffDays = Math.ceil((eventDate - now) / (1000 * 60 * 60 * 24));
                    let label = diffDays === 0 ? 'Today' : diffDays === 1 ? 'Tomorrow' : `${diffDays} days`;
                    if (diffDays < 0) label = 'Past';

                    return `
                        <div class="event-item flex flex-col space-y-1 relative">
                            <div class="flex justify-between items-baseline">
                                <div class="flex gap-1 items-center">
                                    <span class="text-[10px] uppercase tracking-widest text-muted font-medium">${label}</span>
                                    <span class="text-[10px] uppercase tracking-widest text-muted opacity-60">• ${eventDate.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}</span>
                                </div>
                                <div class="relative">
                                    <button onclick="toggleMenu(event, ${e.id})" class="flex items-center justify-center p-1 text-muted hover:text-black w-6 h-6">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="mx-auto"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                                    </button>
                                    <div id="menu-${e.id}" class="menu-dropdown absolute right-0 top-7 py-1 rounded-md z-10">
                                        <button onclick="openEditModal(${e.id})" class="w-full text-left px-3 py-2 text-[11px] hover:bg-gray-50">Edit</button>
                                        <button onclick="deleteEvent(${e.id})" class="w-full text-left px-3 py-2 text-[11px] text-red-500 hover:bg-red-50">Delete</button>
                                    </div>
                                </div>
                            </div>
                            <div class="border-b border-line pb-4">
                                <div class="flex justify-between items-baseline mb-1">
                                    <h3 id="title-${e.id}" onclick="toggleExpand(${e.id}, 'title')" class="expandable text-base font-normal tracking-tight collapsed-text flex-1 pr-4">${e.title}</h3>
                                </div>
                                ${e.description ? `<p id="desc-${e.id}" onclick="toggleExpand(${e.id}, 'desc')" class="expandable collapsed-text text-xs text-muted leading-relaxed">${e.description}</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                let timelineHtml = '';
                const lastDateStr = sorted[sorted.length - 1].date;
                const lastDate = new Date(lastDateStr + 'T00:00:00');
                let cursor = new Date(now);

                while (cursor <= lastDate) {
                    const cStr = getLocalDateString(cursor);
                    const dayEvents = events.filter(e => e.date === cStr);
                    const isToday = cStr === getLocalDateString(now);

                    timelineHtml += `
                        <div class="timeline-day">
                            <div class="timeline-dot ${dayEvents.length ? 'has-event' : ''} ${isToday ? 'is-today' : ''}"></div>
                            <div class="flex flex-col w-full overflow-hidden">
                                <span class="text-[9px] uppercase tracking-tighter font-bold ${dayEvents.length || isToday ? 'text-black' : 'text-muted opacity-30'}">
                                    ${cursor.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}
                                </span>
                                <div class="space-y-2 mt-1 w-full">
                                    ${dayEvents.map(e => `
                                        <div class="roadmap-event">
                                            <div class="flex justify-between items-start gap-2">
                                                <div class="flex-1 overflow-hidden">
                                                    <span id="rm-title-${e.id}" onclick="toggleExpand(${e.id}, 'rm-title')" 
                                                          class="expandable text-[11px] font-medium block collapsed-text">
                                                        ${e.title}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    cursor.setDate(cursor.getDate() + 1);
                }
                timelineContainer.innerHTML = timelineHtml;
            }
        }

        render();
    </script>
</body>
</html>

